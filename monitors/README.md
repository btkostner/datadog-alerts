# Monitors

This folder declares Datadog monitors. These are stand alone monitors that don't fall under any SLO. If you want to create a new SLO or modify an SLO's monitor, see the `slos/` folder in this repository.

Any `.yml` file in this folder will be picked up by terraform.

## Structure

To define a monitor, include a block like so in the yaml file:

```yaml
- type: http-error-percentage
  method: POST
  path: /error-page
  critical: 0.1
  warning: 0.05
```

<!-- BEGIN_TF_DOCS -->

## Inputs

| Name              | Description                                                                                                                                                                                                                                   | Type           | Default          | Required |
| ----------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- | ---------------- | :------: |
| name              | Name of the monitor to create in Datadog. This is optional, and will be autogenerated if left empty and type, service, and environment are unique.                                                                                            | `string`       | `null`           |    no    |
| message           | A large text blob used when alerting. This is optional, and will use a standard, non descriptive, message if left empty. Note that if you just want to change who is alerted, you can do so by setting the alert_channels variable.           | `string`       | `null`           |    no    |
| environment       | Environment this monitor is for. This should be staging or production.                                                                                                                                                                        | `string`       | n/a              |   yes    |
| service           | Name of the service this monitor is for. This is used to create the needed tags and link the monitor to the service's APM page.                                                                                                               | `string`       | `""`             |    no    |
| alert_channels    | A list of Datadog tags to include on the alert.                                                                                                                                                                                               | `list(string)` | `[]`             |    no    |
| type              | Type of resource that is being monitored, and how it's being monitored. For more details, look at the type documentation below.                                                                                                               | `string`       | n/a              |   yes    |
| method            | HTTP method being measured. This is only required for HTTP monitor types.                                                                                                                                                                     | `string`       | `""`             |    no    |
| path              | HTTP path being monitored. This is only required for HTTP monitor types.                                                                                                                                                                      | `string`       | `""`             |    no    |
| priority          | Priority of the monitor. By default, this will use the default priority assigned for the monitor type. Unless you have good reason to change the priority, we recommend leaving it generated.                                                 | `number`       | `null`           |    no    |
| percentile        | Percentile to use for the measurement. Valid values are 99, 95, 50, and 5.                                                                                                                                                                    | `number`       | `99`             |    no    |
| custom_type       | The custom type of monitor. This is only needed for custom monitor types. See https://docs.datadoghq.com/api/latest/monitors/#create-a-monitor for more information.                                                                          | `string`       | `"metric alert"` |    no    |
| custom_query      | The raw query used for monitoring when creating a custom monitor. This is different than the query you see in the UI depending on the custom_type. See https://docs.datadoghq.com/api/latest/monitors/#create-a-monitor for more information. | `string`       | `null`           |    no    |
| critical          | Measurement that triggers an error message. For more information about the unit this value is, look at the type documentation below.                                                                                                          | `number`       | n/a              |   yes    |
| warning           | Measurement that triggers a warning message. For more information about the unit this value is, look at the type documentation below.                                                                                                         | `number`       | n/a              |   yes    |
| alert_on_recovery | Automatically send alerts to the listed alert_channels when a monitor recovers                                                                                                                                                                | `bool`         | `true`           |    no    |
| renotify_interval | The number of minutes after the last notification before the monitor re-notifies on the current status.                                                                                                                                       | `number`       | `null`           |    no    |

<!-- END_TF_DOCS -->

## Types

### custom

This is a get out of jail free card, and allows you to specify any custom query string to create a monitor. This is done by setting the `custom_type` and the `custom_query` fields. For more information, see the [Datadog API documentation](https://docs.datadoghq.com/api/latest/monitors/#create-a-monitor).

```yaml
- type: custom
  custom_type: metric alert
  custom_query: 2 > 1
  critical: 1
  warning: 0.05
```

### http-error-percentage

> **NOTE**: This is for Elixir based application metrics.

This measures the total amount of exceptions that occur in a request divided by the total amount of requests that occur. The `critical` and `warning` values are the percentage of errors in the last 10 minutes. For instance, if you put `0.05` in as the critical field, you will get an alert if the error rate goes above 0.05%.

```yaml
- type: http-error-percentage
  method: POST
  path: /error-page
  # Alert when error percentage is above 0.1%
  critical: 0.1
  # Warn when error percentage is above 0.05%
  warning: 0.05
```

### http-latency-max

> **NOTE**: This is for Elixir based application metrics.

This measures how long a request takes in milliseconds.

```yaml
- type: http-latency-max
  method: POST
  path: /high-latency-page
  # Monitor the 95th percentile of requests.
  percentile: 95
  # Monitor alert if latency goes over 10 seconds
  critical: 10000
  # Monitor goes to warning status latency is 5 seconds or more
  warning: 5000
```
